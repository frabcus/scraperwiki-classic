{% extends "frontend/base.html" %}

{% block title %}{{ scraper.title }}{% endblock %}
{% block rss %}<link rel="alternate" type="application/rss+xml" title="RSS" href="/feeds/code_object_comments/{{ scraper.short_name }}" />{% endblock %}

{% block tabs %}
    {% include 'codewiki/includes/tabs.html' %}
{% endblock %}
{% block content %}
    <div class="page_title">
        <ul class="title_links">
            {% ifequal scraper.wiki_type 'scraper'%}
                <li class="api"><a href="{% url api:scraper_sqlite %}?name={{scraper.short_name}}">Explore with ScraperWiki API</a></li>
                {% if sqlitedata %}
                    <li class="sqlite"><a href="{% url export_sqlite scraper.short_name %}" rel="nofollow">Download SQLite3 database</a></li>
                {% endif %}
            {% endifequal %}
            {% ifequal scraper.wiki_type 'view'%}
                <li class="full_screen"><a href="http://{{settings.VIEW_DOMAIN}}{% url rpcexecute scraper.short_name %}">View as full page</a></li>
                <li class="embed"><a href="{% url code_overview scraper.wiki_type scraper.short_name %}#embed">Add to your site</a></li>
            {% endifequal %}
            <li class="fork"><a href="{% url editor scraper.wiki_type scraper.language %}?fork={{scraper.short_name}}">Fork this {{scraper.wiki_type}}</a></li>
        </ul>
        <h1>
            {% if scraper.owner.get_profile.name %}{{ scraper.owner.get_profile.name }}{% else %}{{scraper.owner.username}}{% endif %} / <span id="hCodeTitle">{{ scraper.title }}</span>{% if not scraper.published %} (not public){% endif %}
        </h1>
        <ul class="code_about">
           <li class="codewiki_type {{scraper.wiki_type|lower}}">{{scraper.wiki_type|lower}}</li>
           <li class="language {{scraper.language|lower}}">{{scraper.language|lower}}</li>
           {% if scraper.has_temporal %}
               <li><img src="{{ MEDIA_URL }}/images/icons/date.png"/></li>
           {% endif %}
           {% if scraper.forked_from %}
               <li class="fork">Fork of <a href="{% url code_overview scraper.forked_from.wiki_type scraper.forked_from.short_name %}">{{scraper.forked_from.short_name}}</a></li>
           {% endif %}
            <li>{% if user.is_authenticated %}<a href="#" id="aEditTitle" class="edit">[edit title]</a>{% else %}<a href="{% url login %}?next={% url code_overview scraper.wiki_type scraper.short_name %}" class="edit">[sign in to edit title]</a>{% endif %}</li>
        </ul>
    </div>
    <div class="content full">
        {% if scraper.is_sick_and_not_running %}
            <p class="sick">
                <strong>Maintenance required!</strong> This {{scraper.wiki_type}} might be broken 
                (it generated an exception on its 
                     <a href="{% url scraper_history scraper.wiki_type scraper.short_name %}#run_{{ scraper.last_runevent.id }}">last ran</a>).
                {% ifequal scraper.owner.get_profile user %}
                    <a href="{% url editor_edit scraper.wiki_type scraper.short_name %}">Edit this {{scraper.wiki_type}}</a>.
                {% else %}
                    Do you know {{scraper.language}}? Could you help <a href="{% url editor_edit scraper.wiki_type scraper.short_name %}">fix this {{scraper.wiki_type}}</a>?
                {% endifequal %}
            </p>
        {% endif %}
        <div class="page_tab_body">
                    
            {% block tab %}
            {% endblock %}
        </div>
        <p class="report">
            <strong>Important</strong> If you suspect this scraper breaks our <a href="/terms_and_conditions/">Terms &amp; Conditions</a>, please <a href="/contact/">report it</a>
        </p>
    </div>
{% endblock %}

{% block run_script %}
     scraper_short_name = '{{scraper.short_name}}';

    {% if user.is_authenticated %}
        setupScraperEditInPlace('scraper', '{{scraper.short_name}}');
    {% endif %}
{% endblock %}
