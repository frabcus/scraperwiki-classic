{% extends "frontend/base.html" %}

{% block title %}{{ scraper.title }}{% endblock %}
{% block rss %}<link rel="alternate" type="application/rss+xml" title="RSS" href="/feeds/code_object_comments/{{ scraper.short_name }}" />{% endblock %}

{% block tabs %}
    {% include 'codewiki/includes/tabs.html' %}
{% endblock %}
{% block content %}
    <div class="page_title">
	    <h1 id="hCodeTitle">
            {% if scraper.owner.get_profile.name %}{{ scraper.owner.get_profile.name }}{% else %}{{scraper.owner.username}}{% endif %} / {{ scraper.title }}{% if not scraper.published %} (not public){% endif %}
        </h1>
	    <ul class="code_about">
	       <li class="codewiki_type {{scraper.wiki_type|lower}}">{{scraper.wiki_type|lower}}</li>
	       <li class="language {{scraper.language|lower}}">{{scraper.language|lower}}</li>
           {% if scraper.has_temporal %}
               <li><img src="{{ MEDIA_URL }}/images/icons/date.png"/></li>
           {% endif %}
            <li>{% if user.is_authenticated %}<a href="#" id="aEditTitle" class="edit">[edit title]</a>{% else %}<a href="{% url login %}?next={% url code_overview 'scraper' scraper.short_name %}" class="edit">[sign in to edit title]</a>{% endif %}</li>
	    </ul>
        {% ifequal scraper.wiki_type 'scraper'%}
            <ul class="title_links">
                <li class="csv"><a href="{% url export_csv scraper.short_name %}" rel="nofollow">Download this dataset (CSV)</a></li>
                <li class="api"><a href="{% url api:scraper_getdata %}?name={{scraper.short_name}}">Explore with ScraperWiki API</a></li>
                {% if sqlitedata %}
                    <li class="sqlite"><a href="{% url export_sqlite scraper.short_name %}" rel="nofollow">Download Sqlite3 database</a></li>
                {% else %}
                    {#<li class="gdocs"><a href="{% url export_gdocs_spreadsheet scraper.short_name %}" target="_new" rel="nofollow">Open in Google Docs</a></li>#}
                {% endif %}
            </ul>
        {% endifequal %}
        {% ifequal scraper.wiki_type 'view'%}
            <ul class="title_links">
                <li class="full_screen"><a href="{% url view_fullscreen scraper.short_name %}">View as full page</a></li>
                <li class="embed"><a href="{% url code_overview scraper.wiki_type scraper.short_name %}#embed" title="click to hide this bar">Add to your site</a></li>                
            </ul>
        {% endifequal %}
    </div>
    <div class="content full">
        {% ifequal scraper.status 'sick' %}
          {% if lastscraperrunevent.id %}
          {% ifequal lastscraperrunevent.pid -1 %}
            <p class="sick">
                <strong>Maintenance required!</strong> This {{scraper.wiki_type}} might be broken 
                (it generated an exception on its <a href="{% if lastscraperrunevent.run_id %}{% url run_event lastscraperrunevent.run_id %}{% else %}{% url run_event lastscraperrunevent.id %}{% endif %}">last run</a>).
                {% ifequal scraper.owner.get_profile user %}
                    <a href="{% url editor_edit scraper.wiki_type scraper.short_name %}">Edit this {{scraper.wiki_type}}</a>.
                {% else %}
                    Do you know {{scraper.language}}? Could you help <a href="{% url editor_edit scraper.wiki_type scraper.short_name %}">fix this {{scraper.wiki_type}}</a>?
                {% endifequal %}
            </p>
          {% endifequal %}
          {% endif %}
        {% endifequal %}
        <div class="page_tab_body">
                    
            {% block tab %}
            {% endblock %}
        </div>
        <p class="report">
            <strong>Important</strong> If you suspect this scraper breaks our <a href="/terms_and_conditions/">Terms &amp; Conditions</a>, please <a href="/contact/">report it</a>
        </p>
    </div>
{% endblock %}

{% block run_script %}
     scraper_short_name = '{{scraper.short_name}}';

    {% if user.is_authenticated %}
        setupScraperEditInPlace('scraper', '{{scraper.short_name}}');
    {% endif %}
{% endblock %}
