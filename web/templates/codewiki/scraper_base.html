{% extends "frontend/base.html" %}

{% block title %}{{ scraper.title }}{% endblock %}
{% block rss %}<link rel="alternate" type="application/rss+xml" title="RSS" href="/feeds/code_object_comments/{{ scraper.short_name }}" />{% endblock %}

{% block header %}
	<h2><a href="{% url profiles_profile_detail scraper.owner.username %}">{% if scraper.owner.get_profile.name %}{{scraper.owner.get_profile.name}}{% else %}{{scraper.owner.username}}{% endif %}</a> / {% if user.is_authenticated %}<span id="hCodeTitle" title="Click to edit&hellip;">{{ scraper.title }}</span>{% else %}{{ scraper.title }}{% endif %}</h2>
	<p>{{scraper.wiki_type|lower}} 
	    &bull; {{scraper.language|lower}}
	    &bull; [{{scraper.privacy_status}}]
	{% if scraper.forked_from %}
        &bull; Fork of <a href="{% url code_overview scraper.forked_from.wiki_type scraper.forked_from.short_name %}">{{scraper.forked_from.short_name}}</a>
    {% endif %}
</p>
{% endblock %}

{% block tabs %}
    {% include 'codewiki/includes/tabs.html' %}
{% endblock %}
{% block content %}
    <input type="hidden" id="adminsettagurl" value="{% url scraper_admin_settags scraper.short_name %}"/>

    <div class="page_title">
        <ul class="title_links">
            {% ifequal scraper.wiki_type 'scraper'%}
               <li class="api"><a href="{% url api:scraper_sqlite %}?name={{scraper.short_name}}">Explore with ScraperWiki API</a></li>
               <li class="sqlite"><a href="{% url export_sqlite scraper.short_name %}" rel="nofollow">Download SQLite3 database</a></li>
            {% endifequal %}
            {% ifequal scraper.wiki_type 'view'%}
                <li class="full_screen"><a href="http://{{settings.VIEW_DOMAIN}}{% url rpcexecute scraper.short_name %}">View as full page</a></li>
                <li class="embed"><a href="{% url code_overview scraper.wiki_type scraper.short_name %}#embed">Add to your site</a></li>
            {% endifequal %}
            <li class="fork"><a href="{% url editor scraper.wiki_type scraper.language %}?fork={{scraper.short_name}}">Fork this {{scraper.wiki_type}}</a></li>
            {% if user.is_authenticated %}
        	<li class="edit_title"><a href="#" id="aEditTitle">Edit title</a></li>
        	{% endif %}
        </ul>
    </div>
    <div class="content full">
        {% if scraper.is_sick_and_not_running %}
            <p class="sick">
                <strong>Maintenance required!</strong> This {{scraper.wiki_type}} might be broken 
                (it generated an exception on its 
                     <a href="{% url scraper_history scraper.wiki_type scraper.short_name %}#run_{{ scraper.last_runevent.id }}">last run</a>).
                {% ifequal scraper.owner.get_profile user %}
                    <a href="{% url editor_edit scraper.wiki_type scraper.short_name %}">Edit this {{scraper.wiki_type}}</a>.
                {% else %}
                    Do you know {{scraper.language}}? Could you help <a href="{% url editor_edit scraper.wiki_type scraper.short_name %}">fix this {{scraper.wiki_type}}</a>?
                {% endifequal %}
            </p>
        {% endif %}
        <div class="page_tab_body">
            {% block tab %}
            {% endblock %}
        </div>
        <p class="report">
            <strong>Important</strong> If you suspect this scraper breaks our <a href="/terms_and_conditions/">Terms &amp; Conditions</a>, please <a href="/contact/">report it</a>
        </p>
    </div>
{% endblock %}

{% block run_script %}
     scraper_short_name = '{{scraper.short_name}}';

    {% if user.is_authenticated %}
        setupScraperEditInPlace('scraper', '{{scraper.short_name}}');
    {% endif %}
{% endblock %}
