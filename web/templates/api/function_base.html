{% extends "frontend/base.html" %}

{% block javascript %}
    <script type="text/javascript" src="{{ MEDIA_URL }}js/apisetupexplore.js?{{settings.REVISION}}"></script>	
    <script>
      var otherapis = {% if otherapis %}{{otherapis|safe}}{% else %}[]{% endif %};
      var getinfourl = "http://{{api_domain}}/api/1.0/scraper/getinfo"; 
    </script>	
{% endblock %}

{% block content %}

    <div class="page_title">
        <h1>{% block heading %}{% endblock %}</h1>
        <p>{% block subheading %}{% endblock %}   <small><a href="{% url api:index %}">(return to api overview)</a></small></p>
        <p><b><a id="aApiLink" class="api_link" href="http://{{api_domain}}{{api_uri}}">http://{{api_domain}}{{api_uri}}<span></span></a></b></p>
    </div>

    <div class="content col left">
        <h2>Arguments</h2>
        <form class="api_arguments" target="iframeResponse" method="post" action="{% url api:explorer_call %}">
            <fieldset>
                <input type="hidden" id="uri" name="uri" value="http://{{api_domain}}{{api_uri}}"/>
            </fieldset>
            <dl>
                {% block arguments %}
                {% endblock %}
            </dl>
            <div>
                <input type="submit" id="btnCallMethod" class="button" value="Call method ..."/>
            </div>
        </form>

        <div class="explorer_response">
        <h2>Function response</h2>
            <iframe name="iframeResponse" id="api_response" src="{% block example_url %}{% endblock %}"></iframe>
        </div>
    </div>

    <div class="content col right">
        <h3>Useful values</h3>
        {% comment %}
            {% if user.is_authenticated and keys %}
                <h4>API keys</h4>
                <ul id="ulApiKeys" class="api_suggest">
    		      {% for key in keys %}
    		        <li><code title="{{key.key}}">{{ key.key }}</code><br/><small>({{ key.description }})</small></li>
    		      {% endfor %}
                </ul>
            {% endif %}
        {% endcomment %}

        <h4>Response formats</h4>
        <ul id="ulFormats" class="api_suggest">
            <li><code>csv</code></li>
            <li><code>jsonlist</code></li>
            <li><code>jsondict</code></li>
        </ul>

        {% if scrapers %}
        <h4>Scraper short names</h4>        
        <ul id="ulScraperShortNames" class="api_suggest">
            {% for scraper in scrapers %}
                <li><code title="{{scraper.title}}">{{scraper.short_name}}</code></li>
            {% endfor %}	                
        </ul>
        {% endif %}

        {% if users %}
        <h4>User names</h4>        
        <ul id="ulUserNames" class="api_suggest">
            {% for user in users %}
                <li><code title="{{user.get_profile.name}}">{{user.username}}</code></li>
            {% endfor %}	                
        </ul>
        {% endif %}

        <div id="scraperdetails">
          <h4>More about <a id="aScraperLink"></a></h4>
          <ul id="otherapis"></ul>
          <input type="button" id="scraperlisttables" value="List tables"/>
          <ul id="listtables"></ul>
        </div>

    </div>
    
{% endblock %}

{% block run_script %}APISetupExploreFunction();{% endblock %}