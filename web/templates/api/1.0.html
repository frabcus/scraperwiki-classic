{% extends "frontend/base.html" %}
{% block title %}API{% endblock %}
{% block content %}

<div class="page_title">
    <h1>ScraperWiki API</h1>
    <p>
        Documentation for the ScraperWIki API -- <em>or how to use your computer to talk to our computer</em>
    </p>
</div>
<div class="content col left">
    <div class="section">
        <h2>Overview</h2>
        <p>
            The ScraperWiki API lets you retrieve data from the ScraperWiki datastore to use in your own applications.
        </p>
        {% comment %}
            <p>
                {% if user.is_authenticated %}
                    To get started you need to <a href="{% url api:keys %}">request an API key</a>.
                {% else %}
                    To get started you need to <a href="{% url login %}?next={% url api:index %}">create an account</a> and then <a href="{% url api:keys %}">request an API key</a>.        
                {% endif %}
            </p>
        {% endcomment %}        
        
        <p>
            Each API function has its own URI. You need to pass the format you would like the data returned in and other function-specific arguments via the query string to tell the API exactly what you are requesting:
            <code class="api_call">
     http://api.scraperwiki.com/api/1.0/datastore/getdata?name=<em>[scraper short name]</em>&amp;format<em>=[csv | json | jsondict]</em>&amp;limit=<em>100</em>&amp;offset=<em>0</em>
            </code>
        </p>
    </div>
    <div class="section">
        <h2>Formats</h2>
        <p>The API can return data in any of the following formats:</p>
        <table class="api_detail">
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Argument</th>
                    <th>Description</th>                
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><a href="http://en.wikipedia.org/wiki/Comma-separated_values">Comma separated values (CSV)</a></td>
                    <td>csv</td>
                    <td>Comma separated values where the first line lists the titles of the columns and the 
                        subsequent lines have the same number of comma separated entries</td>
                </tr>
                <tr>
                    <td><a href="http://www.json.org/">JSON</a></td>
                    <td>json</td>
                    <td>
                        A text-based representation of a Javascript object. It can be converted back into an object using the 
                        <code><a href="http://www.devguru.com/Technologies/ecmascript/quickref/eval.html">eval()</a></code> 
                        function in Javascript, and many other languages have code libraries available.<br/>
                        The representation for a table is<br/>
                        <code>{ keys:["key1", "key2"], values:[["val11", "val12], ["val11", "val12"]] }</code>
                    </td>
                </tr>
                <tr>
                    <td><a href="http://www.json.org/">JSONDICT</a></td>
                    <td>jsondict</td>
                    <td>
                        A different form of data layout in json where the keys are listed per record
                        and the records are dicts<br/>
                        <code>[ {"key1":"val11", "key2":"val12"}, {"key1":"val21", "key2":"val22"} ]</code>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>
    
    <div class="section">
        <h2>Status and error codes</h2>
        <p>
            API calls return the following HTTP status codes. You should check for these to see if your request was OK:
        </p>
        <table class="api_detail">
            <thead>
                <tr>
                    <th>Code</th>
                    <th>Description</th>                
                </tr>
            </thead>
            <tbody>
                <tr>
                    <td><strong>200</strong> OK</td>
                    <td>Everything went well</td>
                </tr>    
                <tr class="not_implemented" title="Not implemented yet">
                    <td><strong>201</strong> Created</td>
                    <td>Object was created</td>
                </tr>    
                <tr>
                    <td><strong>204</strong> (Empty body, as per RFC2616)</td>
                    <td>Object was deleted</td>
                </tr> 
                <tr>
                    <td><strong>400</strong> Bad Request</td>
                    <td>Request was malformed / not understood / data not found</td>
                </tr>    
                <tr>    
                    <td><strong>401</strong> Forbidden</td>
                    <td>Permission denied</td>
                </tr>
                <tr class="not_implemented" title="Not implemented yet">
                    <td><strong>409</strong> Conflict/Duplicate</td>
                    <td>Object already exists</td>
                </tr>    
                <tr>
                    <td><strong>410</strong> Gone</td>
                    <td>Object does not exist</td>
                </tr>
                <tr>
                    <td><strong>501</strong> Not Implemented</td>
                    <td>Action not available</td>
                </tr>
                <tr>
                    <td><strong>503</strong> Throttled</td>
                    <td>Request was throttled</td>
                </tr>        
            </tbody>
        </table>
    </div>
    <div class="section">
        <h2>Code libraries</h2>
        <p><a href="{% url api:libraries %}">Coming soon</a></p>
    </div>
</div>

<div class="content col right">
    {% comment %}
        <p>
            <a href="{% url api:keys %}">Manage your API keys</a>
        </p>
    {% endcomment %}
    <h4>API functions</h4>

    <h5>Datastore</h5>
    <ul>
        <li><a href="{% url api:scraper_sqlite %}">scraperwiki.datastore.sqlite</a></li>
        <li><a href="{% url api:scraper_getdata %}">scraperwiki.datastore.getData</a></li>
    </ul>

    <h5>Scrapers</h5>
    <ul>
        <li><a href="{% url api:scraper_search %}">scraperwiki.scraper.search</a></li>
        <li><a href="{% url api:scraper_getinfo %}">scraperwiki.scraper.getInfo</a></li>
        <li><a href="{% url api:scraper_getruninfo %}">scraperwiki.scraper.getRunInfo</a></li>
        <li><a href="{% url api:scraper_getuserinfo %}">scraperwiki.scraper.getUserInfo</a></li>
    </ul>

    <h5>Geo</h5>
    <ul>
        <li><a href="{% url api:geo_postcodetolatlng %}">scraperwiki.geo.postcodeToLocation</a></li>
    </ul>

    <h5>Legacy functions pending migration</h5>
    <ul>
        <li><a href="{% url api:datastore_getkeys %}">scraperwiki.datastore.getKeys</a></li>
        <li><a href="{% url api:scraper_getdatabydate %}">scraperwiki.datastore.getDataByDate</a></li>
        <li><a href="{% url api:scraper_getdatabylocation %}">scraperwiki.datastore.getDataByLocation</a></li>
        <li><a href="{% url api:datastore_search %}">scraperwiki.datastore.search</a></li>
    </ul>
</div>

{% endblock %}
