{% extends "frontend/base.html" %}

{% block title %}Docs - External API{% endblock %}

{% block javascript %}
    <script type="text/javascript" src="{{ MEDIA_URL }}js/requestoptions.js?{{settings.REVISION}}"></script>	
    <script>
        var showinglookup = { 
            sqlite:'.format, .name, .attach, .query, .callback', 
            getinfo:'.format, .name, .version, .history_start_date, .quietfields, .callback',
            getruninfo:'.format, .name, .runid, .callback',
            getuserinfo:'.format, .username, .callback',
            search:'.format, .searchquery, .maxrows, .callback'
        }
    </script>
{% endblock %}

{% block header %}
  <h2>Docs &ndash; External API</h2>
  <p>How to get data out of ScraperWiki via a REST API</p>
{% endblock %}

{% block content %}

<p class="language_chooser">
    {% if not docindex %}
    <a href="{% url docs language %}" class="back" title="Back to documentation homepage">
        <img src="{{ MEDIA_URL }}/images/icons/back_arrow.png" width="16" height="16" alt="" />
        List of documentation</a>
    {% endif %}
   <br class="clear"/>
</p>
   <br class="clear"/>


<div id="request_intro">
	<p class="first">The ScraperWiki external interface allows you to extract data in the form you want for use on the web or in your own applications.  You can also extract information about the state of any scraper.</p>
	<span></span>
	<p class="last">Please select the function on the right that you want to learn how to use</p>
</div>

<div id="request_options">
	<h3><a href="#sqlite">scraperwiki.datastore.sqlite</a></h3>
	<div id="sqlite">
		<p>Query and extract your data via a general purpose SQL interface.</p>
	</div>
	<h3><a href="#getinfo">scraperwiki.scraper.getinfo</a></h3>
	<div id="getinfo">
		<p>Extract any data about a scraper, including the code, who has been editing it and any historical versions.</p>
	</div>
	<h3><a href="#getruninfo">scraperwiki.scraper.getruninfo</a></h3>
	<div id="getruninfo">
		<p>See what the scraper did during each run.</p>
	</div>
	<h3><a href="#getuserinfo">scraperwiki.scraper.getuserinfo</a></h3>
	<div id="getuserinfo">
		<p>Find out information about a user of the system.</p>
	</div>
	<h3><a href="#search">scraperwiki.scraper.search</a></h3>
	<div id="search">
		<p>Search the titles and descriptions of all our scrapers.</p>
	</div>

    <ul id="listtables"></ul>
</div>

<form id="request_form">
	<ul>
    <input class="hide" type="text" name="category" id="id_category">
    <input class="hide" type="text" name="function" id="id_category_title">
	<li class="format">
        <label for="id_format">format</label>
        <select type="text" name="format" id="id_format">
            <option value="csv">csv</option>
            <option value="jsondict" selected>jsondict</option>
            <option value="jsonlist">jsonlist</option>
        </select>
	</li> 
	<li class="name">
        <label for="id_name">name<span class="desc"> of the scraper</span></label>
        <input type="text" name="name" id="id_name" value="{{name}}">
	</li> 
	<li class="username">
        <label for="id_username">username</label>
        <input type="text" name="username" id="id_username">
	</li> 
	<li class="version">
        <label for="id_version">version<span class="desc"> number (-1 for most recent)</span></label>
        <input type="text" name="version" id="id_version" value="-1">
	</li> 
	<li class="runid">
        <label for="id_runid">runid</label>
        <input type="text" name="runid" id="id_runid">
	</li> 
	<li class="history_start_date">
        <label for="id_history_start_date">history_start_date<span class="desc"> (optional)</span></label>
        <input type="text" name="history_start_date" id="id_history_start_date">
	</li> 
	<li class="quietfields">
        <label for="id_quietfields">quietfields<span class="desc"> not included in the output for quicker respnse, delimited by '|' (eg 'code|runevents')</span></label>
        <input type="text" name="quietfields" id="id_quietfields">
	</li> 
	<li class="attach">
        <label for="id_attach">attach<span class="desc"> datastores from other scrapers, delimited by ';' (refer to <a href="{% url docs 'python' 'python_help_documentation' %}">internal api</a>)</span></label>
        <input type="text" name="attach" id="id_attach">
	</li> 
	<li class="query">
        <label for="id_query">query<span class="desc"> in SQL</span></label>
        <textarea name="query" id="id_query">select * from swdata limit 10</textarea>
	</li> 
	<li class="searchquery">
        <label for="id_searchquery">searchquery</label>
        <input type="text" name="searchquery" id="id_searchquery">
	</li> 
	<li class="maxrows">
        <label for="id_maxrows">maxrows</label>
        <input type="text" name="maxrows" id="id_maxrows" value="5">
	</li> 
	<li class="callback">
        <label for="id_callback">callback<span class="desc"> for JSONP (optional)</span></label>
        <input type="text" name="callback" id="id_callback">
	</li> 
	</ul>

    <p id="terms_and_conditions">
        We reserve the right to apply a rate limit to large requests at a later date in order to pass on reasonable costs <a href="{% url terms %}">terms and conditions</a>.
    </p>
</form>

<div class="explorer_response">
  <h2>Function response</h2>
  <form action="{% url api_explore %}" method="post" target="iframeResponse">
    <input type="submit" id="btnCallMethod" class="button" value="Call method ..."/>
    <textarea name="apiurl" id="id_apiuri" cols="70" rows="3"></textarea>
  </form>
  <input type="text" id="id_api_base" value="{{api_base}}" class="hide">
  <iframe name="iframeResponse" id="api_response" src="{% url api_explore %}"></iframe>
</div>


<br class="clear" />
{% endblock %}
