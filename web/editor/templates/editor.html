{% extends "editor_base.html" %}

{% block css %}
    <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/jquery-ui-1.7.2.custom.css" />
    <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/main.css" />
    <link rel="stylesheet" type="text/css" href="{{ MEDIA_URL }}css/editor.css" />
{% endblock %}

{% block js %}
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-1.3.2.min.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery-ui-1.7.2.custom.min.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.form.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}js/jquery.comet.js"></script>


    <script type="text/javascript" src="{{ MEDIA_URL }}CodeMirror-0.63/js/codemirror.js"></script>
    <script type="text/javascript" src="{{ MEDIA_URL }}/js/editor.js"></script>  

{% endblock %}

{% block header %}
    {{ scraper.title }}
{% endblock %}

{% block content %}

    <fieldset>
        {# Hidden inputs for passing to js #}
        <input type="hidden" id="scraper_short_name" value="{{ scraper.short_name }}"/>
        <input type="hidden" id="code_runningMode" value="{{ settings.CODE_RUNNING_MODE|escape }}"/>    
    </fieldset>

    <form method="POST" accept-charset="utf-8" id="editor" action="">
        <div class="editor">

            {# Header #}
            <div class="editor_header">
                <div class="title">    
                    {{ form.title }}
                </div>
                <div id="meta_fields_mini">
                    {# for form elements that are shown in the popup #}

                    <div class="field field-description">
                        <label for="id_description">{{ form.description.label}} {{ form.license.errors }}</label>
                        {{ form.description }}
                    </div>
            
                    <div class="field field-license">
                        <label for="id_license">{{ form.license.label }} {{ form.license.errors }}</label>
                        {{ form.license }}
                    </div>
            
                    <div class="field field-source">
                        <label for="id_source">{{ form.source.label}} {{ form.source.errors }}</label>
                        {{ form.source }}

                    </div>
                </div>

                <ul class="help">
                    <li>
                        <a id="menu_shortcuts" href="#">Keyboard shortcuts</a>
                    </li>
                    <li>
                        <a id="menu_settings" href="#">Editor settings</a>
                    </li>
                    <li class="helplink">
                        <a id="menu_documentation" href="#">Code documentation</a>
                    </li>
                </ul>          
            </div>
        
            {# Code editor #}
            <div class="editor_code" id="codeeditordiv">
                {{ form.code }}
            </div>

            {# Controls #}
            <div class="editor_controls">
                <input type="submit" id="save" name="action" value="Save" />            
                <input type="button" id="clear" name="action" value="Clear Console" />   
                <span id="notifications"></span>

                <div class="right">         
                    {% if short_name %}
                        <a href="{% url scraper_code short_name %}">Close and discard changes</a>
                    {% else %}
                        <a href="{% url frontpage %}">Close and discard changes</a>                
                    {% endif %}
                    <input type="submit" id="commit" name="action" value="Commit and close"/>            
                </div>
            </div>

            {# Consoles #}
            <div class="editor_output" id="outputeditordiv">
                <div class="tabs">
                    <ul>
                        <li class="console">
                            <a href="#">Console</a>
                        </li>
                        <li class="data">
                            <a href="#">Data</a>                            
                        </li>
                        <li class="sources">
                            <a href="#">Sources</a>                            
                        </li>
                    </ul>
                </div>
                <div class="info">
                    <div id="output_console">
                        <div></div>
                    </div>
                    <div id="output_data">
                        <table>

                        </table>
                    </div>
                    <div id="output_sources">
                        <div></div>                        
                    </div>
                </div>
                <iframe name="console" id="console" style="display:none;"><pre></pre></iframe>
            </div>
      </div>

{% endblock %}

{% block popups %}    
    <div id="meta_form" class="popup_item"><a class="popupClose">x</a></div>
    <div id="diff" class="popup_item"><a class="popupClose">x</a><pre></pre></div>
    <div id="popup_shortcuts" class="popup_item">
        <a class="popupClose">x</a><pre></pre>
    </div>
    <div id="popup_settings" class="popup_item">
        <a class="popupClose">x</a>
    </div>    
    <div id="popup_documentation" class="popup_item">
        <a class="popupClose">x</a>
        <h3>Quick help</h3>
    </div>
    <div id="popup_text" class="popup_item">
        <a class="popupClose">x</a>
    </div>            
</form>
{% endblock %}
